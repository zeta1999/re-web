<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Server (re-web.ReWeb.Server)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">re-web</a> &#x00BB; <a href="../index.html">ReWeb</a> &#x00BB; Server</nav><h1>Module <code>ReWeb.Server</code></h1><p>Create and serve endpoints.</p></header><aside></aside><div class="spec module" id="module-Request"><a href="#module-Request" class="anchor"></a><code><span class="keyword">module</span> <a href="Request/index.html">Request</a>: <a href="../Request/index.html#module-type-S">Request.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../Request/module-type-S/Reqd/index.html#type-t">Reqd.t</a> = Httpaf.Reqd.t;</code></div><div class="spec module" id="module-Service"><a href="#module-Service" class="anchor"></a><code><span class="keyword">module</span> <a href="Service/index.html">Service</a>: <a href="../Service/index.html#module-type-S">Service.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../Service/module-type-S/Request/Reqd/index.html#type-t">Request.Reqd.t</a> = Httpaf.Reqd.t <span class="keyword">and</span> <span class="keyword">type</span> <a href="../Service/module-type-S/Request/index.html#type-t">Request.t</a>('ctx) = <a href="Request/index.html#type-t">Request.t</a>(<span class="type-var">'ctx</span>);</code></div><div class="spec module" id="module-Filter"><a href="#module-Filter" class="anchor"></a><code><span class="keyword">module</span> <a href="Filter/index.html">Filter</a>: <a href="../Filter/index.html#module-type-S">Filter.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../Filter/module-type-S/Service/Request/Reqd/index.html#type-t">Service.Request.Reqd.t</a> = Httpaf.Reqd.t <span class="keyword">and</span> <span class="keyword">type</span> <a href="../Filter/module-type-S/Service/Request/index.html#type-t">Service.Request.t</a>('ctx) = <a href="Request/index.html#type-t">Request.t</a>(<span class="type-var">'ctx</span>) <span class="keyword">and</span> <span class="keyword">type</span> <a href="../Filter/module-type-S/Service/index.html#type-t">Service.t</a>('ctx, 'resp) = <a href="Service/index.html#type-t">Service.t</a><span>(<span class="type-var">'ctx</span>, <span class="type-var">'resp</span>)</span>;</code></div><dl><dt class="spec type" id="type-path"><a href="#type-path" class="anchor"></a><code><span class="keyword">type</span> path</code><code> = list(string)</code>;</dt><dt class="spec type" id="type-route"><a href="#type-route" class="anchor"></a><code><span class="keyword">type</span> route</code><code> = <span>(Httpaf.Method.t, <a href="index.html#type-path">path</a>)</span></code>;</dt><dd><p>Pattern-matchable identifier of the request for routing purposes. Consists of:</p><ul><li>HTTP method e.g. <code>`GET</code>, <code>`POST</code></li><li><code>path</code> i.e. a list of path segments</li></ul><p>E.g., <code>GET /api/user/1</code> would be represented as <code>(`GET, [&quot;api&quot;, &quot;user&quot;, &quot;1&quot;])</code></p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t('ctx, 'resp)</code><code> = <a href="index.html#type-route">route</a> <span>=&gt;</span> <a href="Service/index.html#type-t">Service.t</a><span>(<span class="type-var">'ctx</span>, <span class="type-var">'resp</span>)</span></code>;</dt><dd><p>A server is a function that takes a <code>route</code> and returns a service. A route is pattern-matchable (see above), so you will almost always do that to handle different endpoints with different services.</p></dd></dl><dl><dt class="spec value" id="val-resource"><a href="#val-resource" class="anchor"></a><code><span class="keyword">let</span> resource: <span>?&#8288;index:<a href="Service/index.html#type-all">Service.all</a>(<span class="type-var">'ctx</span>)</span> <span>=&gt;</span> <span>?&#8288;create:<a href="Service/index.html#type-all">Service.all</a>(<span class="type-var">'ctx</span>)</span> <span>=&gt;</span> <span>?&#8288;new_:<a href="Service/index.html#type-all">Service.all</a>(<span class="type-var">'ctx</span>)</span> <span>=&gt;</span> <span>?&#8288;edit:<span>(string <span>=&gt;</span> <a href="Service/index.html#type-all">Service.all</a>(<span class="type-var">'ctx</span>))</span></span> <span>=&gt;</span> <span>?&#8288;show:<span>(string <span>=&gt;</span> <a href="Service/index.html#type-all">Service.all</a>(<span class="type-var">'ctx</span>))</span></span> <span>=&gt;</span> <span>?&#8288;update:<span>(<span>[ `PATCH <span>| `PUT</span> ]</span> <span>=&gt;</span> string <span>=&gt;</span> <a href="Service/index.html#type-all">Service.all</a>(<span class="type-var">'ctx</span>))</span></span> <span>=&gt;</span> <span>?&#8288;destroy:<span>(string <span>=&gt;</span> <a href="Service/index.html#type-all">Service.all</a>(<span class="type-var">'ctx</span>))</span></span> <span>=&gt;</span> <a href="index.html#type-route">route</a> <span>=&gt;</span> <a href="Service/index.html#type-all">Service.all</a>(<span class="type-var">'ctx</span>);</code></dt><dd><p><code>resource(?index, ?create, ?new_, ?edit, ?show, ?update, ?destroy)</code> returns a resource--that is a server--with the standard HTTP CRUD actions that you specify as services. The resource handles the paths and sets a reasonable cache policy corresponding to those CRUD actions:</p><ul><li><code>GET /scope</code> or <code>GET /scope/</code> calls <code>index</code></li><li><code>POST /scope</code> calls <code>create</code> and disables caching</li><li><code>GET /scope/new</code> or <code>GET /scope/new/</code> calls <code>new_</code> and sets the response to cache publicly for a week</li><li><code>GET /scope/id/edit</code> or <code>GET /scope/id/edit/</code> calls <code>edit id</code></li><li><code>GET /scope/id</code> or <code>GET /scope/id/</code> calls <code>show id</code></li><li><code>PATCH /scope/id</code> calls <code>update `PATCH id</code> and disables caching</li><li><code>PUT /scope/id</code> calls <code>update `PUT id</code> and disables caching</li><li><code>DELETE /scope/id</code> calls <code>destroy id</code> and disables caching</li></ul><p>The <code>scope</code> above is whatever scope you put the resource inside in a parent router, or maybe even the toplevel scope <code>/</code> if you use the resource directly as your toplevel server.</p><p>All the service parameters are optional, with a 404 Not Found response as the default. Note that <code>resource</code> is just a convenience function; you can implement a custom resource yourself if needed, by creating a server function of type <code>('ctx, 'resp) t</code> instead.</p></dd></dl><dl><dt class="spec value" id="val-serve"><a href="#val-serve" class="anchor"></a><code><span class="keyword">let</span> serve: <span>?&#8288;port:int</span> <span>=&gt;</span> <a href="index.html#type-t">t</a><span>(unit, <span>[ <a href="../Response/index.html#type-http">Response.http</a> <span>| <a href="../Response/index.html#type-websocket">Response.websocket</a></span> ]</span>)</span> <span>=&gt;</span> unit;</code></dt><dd><p><code>serve(?port, server)</code> starts the top-level <code>server</code> listening on <code>port</code>. Top-level servers must have no context i.e. their context is <code>()</code>.</p></dd></dl></div></body></html>