<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Filter (re-web.ReWeb.Server.Filter)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">re-web</a> &#x00BB; <a href="../../index.html">ReWeb</a> &#x00BB; <a href="../index.html">Server</a> &#x00BB; Filter</nav><h1>Module <code>Server.Filter</code></h1></header><div class="spec module" id="module-Config"><a href="#module-Config" class="anchor"></a><code><span class="keyword">module</span> <a href="Config/index.html">Config</a>: <a href="../../../ReWeb__Config/index.html#module-type-S">ReWeb__Config.S</a>;</code></div><div class="spec module" id="module-Service"><a href="#module-Service" class="anchor"></a><code><span class="keyword">module</span> <a href="Service/index.html">Service</a>: <a href="../../Service/index.html#module-type-S">Service.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../Service/module-type-S/Request/Reqd/index.html#type-t">Request.Reqd.t</a> = Httpaf.Reqd.t <span class="keyword">and</span> <span class="keyword">type</span> <a href="../../Service/module-type-S/Request/index.html#type-t">Request.t</a>('ctx) = <a href="../Request/index.html#type-t">Request.t</a>(<span class="type-var">'ctx</span>) <span class="keyword">and</span> <span class="keyword">type</span> <a href="../../Service/module-type-S/index.html#type-t">t</a>('ctx, 'resp) = <a href="../Service/index.html#type-t">Service.t</a><span>(<span class="type-var">'ctx</span>, <span class="type-var">'resp</span>)</span>;</code></div><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t('ctx1, 'ctx2, 'resp)</code><code> = <a href="Service/index.html#type-t">Service.t</a><span>(<span class="type-var">'ctx2</span>, <span class="type-var">'resp</span>)</span> <span>=&gt;</span> <a href="Service/index.html#type-t">Service.t</a><span>(<span class="type-var">'ctx1</span>, <span class="type-var">'resp</span>)</span></code>;</dt><dd><p>A filter transforms a service. It can change the request (usually by changing the request context) or the response (by actually running the service and then modifying its response).</p><p>Filters can be composed using function composition.</p></dd></dl><dl><dt class="spec value" id="val-basic_auth"><a href="#val-basic_auth" class="anchor"></a><code><span class="keyword">let</span> basic_auth: <a href="index.html#type-t">t</a><span>(<span class="type-var">'ctx1</span>, {. username: string, password: string, prev: <span class="type-var">'ctx1</span>, }, <a href="../../Response/index.html#type-t">Response.t</a>(<span class="type-var">_</span>))</span>;</code></dt><dd><p><code>basic_auth</code> decodes and stores the login credentials sent with the <code>Authorization</code> header or returns a 401 Unauthorized error if there is none.</p></dd></dl><dl><dt class="spec value" id="val-bearer_auth"><a href="#val-bearer_auth" class="anchor"></a><code><span class="keyword">let</span> bearer_auth: <a href="index.html#type-t">t</a><span>(<span class="type-var">'ctx1</span>, {. bearer_token: string, prev: <span class="type-var">'ctx1</span>, }, <a href="../../Response/index.html#type-t">Response.t</a>(<span class="type-var">_</span>))</span>;</code></dt><dd><p><code>bearer_auth</code> stores the bearer token sent with the <code>Authorization</code> header or returns a 401 Unauthorized error if there is none.</p></dd></dl><dl><dt class="spec value" id="val-body_form"><a href="#val-body_form" class="anchor"></a><code><span class="keyword">let</span> body_form: <a href="../../Form/index.html#type-t">Form.t</a><span>(<span class="type-var">'ctor</span>, <span class="type-var">'ty</span>)</span> <span>=&gt;</span> <a href="index.html#type-t">t</a><span>(unit, <span class="type-var">'ty</span>, <span>[&gt; <a href="../../Response/index.html#type-http">Response.http</a> ]</span>)</span>;</code></dt><dd><p><code>body_form(typ)</code> is a filter that decodes a web form in the request body and puts it inside the request for the next service. The decoding is done as specified by the form definition <code>typ</code>. If the form fails to decode, it short-circuits and returns a 400 Bad Request.</p></dd></dl><dl><dt class="spec value" id="val-body_json"><a href="#val-body_json" class="anchor"></a><code><span class="keyword">let</span> body_json: <a href="index.html#type-t">t</a><span>(unit, Yojson.Safe.t, <span>[&gt; <a href="../../Response/index.html#type-http">Response.http</a> ]</span>)</span>;</code></dt><dd><p><code>body_json</code> is a filter that transforms a 'root' service (i.e. one with <code>unit</code> context) into a service with a context containing the request body. If the request body fails to parse as valid JSON, it short-circuits and returns a 400 Bad Request.</p></dd></dl><dl><dt class="spec value" id="val-body_json_decode"><a href="#val-body_json_decode" class="anchor"></a><code><span class="keyword">let</span> body_json_decode: <span>(Yojson.Safe.t <span>=&gt;</span> Stdlib.result<span>(<span class="type-var">'ty</span>, string)</span>)</span> <span>=&gt;</span> <a href="index.html#type-t">t</a><span>(Yojson.Safe.t, <span class="type-var">'ty</span>, <span>[&gt; <a href="../../Response/index.html#type-http">Response.http</a> ]</span>)</span>;</code></dt><dd><p><code>body_json_decode(decoder)</code> is a filter that transforms a service with a parsed JSON structure in its context, to a service with a decoded value of type <code>'ty</code> in its context. If the request body fails to decode with <code>decoder</code>, the filter short-circuits and returns a 400 Bad Request.</p></dd></dl><dl><dt class="spec value" id="val-body_string"><a href="#val-body_string" class="anchor"></a><code><span class="keyword">let</span> body_string: <a href="index.html#type-t">t</a><span>(unit, string, <span>[&gt; <a href="../../Response/index.html#type-http">Response.http</a> ]</span>)</span>;</code></dt><dd><p><code>body_string</code> is a filter that transforms a 'root' service into a service whose context contains the request body as a single string.</p></dd></dl><dl><dt class="spec value" id="val-cache_control"><a href="#val-cache_control" class="anchor"></a><code><span class="keyword">let</span> cache_control: <a href="../../../ReWeb__Header/CacheControl/index.html#type-t">ReWeb__Header.CacheControl.t</a> <span>=&gt;</span> <a href="index.html#type-t">t</a><span>(<span class="type-var">'ctx</span>, <span class="type-var">'ctx</span>, <span>[ <a href="../../Response/index.html#type-http">Response.http</a> <span>| <a href="../../Response/index.html#type-websocket">Response.websocket</a></span> ]</span>)</span>;</code></dt><dd><p><code>cache_control(policy)</code> is a filter that applies the caching <code>policy</code> policy to the HTTP response.</p></dd></dl><dl><dt class="spec value" id="val-cors"><a href="#val-cors" class="anchor"></a><code><span class="keyword">let</span> cors: <a href="../../../ReWeb__Header/AccessControlAllowOrigin/index.html#type-t">ReWeb__Header.AccessControlAllowOrigin.t</a> <span>=&gt;</span> <a href="index.html#type-t">t</a><span>(<span class="type-var">'ctx</span>, <span class="type-var">'ctx</span>, <span>[ <a href="../../Response/index.html#type-http">Response.http</a> <span>| <a href="../../Response/index.html#type-websocket">Response.websocket</a></span> ]</span>)</span>;</code></dt><dd><p><code>cors(origin)</code> adds an <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin">Access-Control-Allow-Origin</a> header with the given <code>origin</code>.</p><p><i>Note</i> that it's upto you to pass in a well-formed origin string. The <code>Header.AccessControlAllowOrigin</code> module does not validate the origin string.</p></dd></dl><dl><dt class="spec value" id="val-csp"><a href="#val-csp" class="anchor"></a><code><span class="keyword">let</span> csp: <a href="../../../ReWeb__Header/ContentSecurityPolicy/index.html#type-t">ReWeb__Header.ContentSecurityPolicy.t</a> <span>=&gt;</span> <a href="index.html#type-t">t</a><span>(<span class="type-var">'ctx</span>, <span class="type-var">'ctx</span>, <span>[ <a href="../../Response/index.html#type-http">Response.http</a> <span>| <a href="../../Response/index.html#type-websocket">Response.websocket</a></span> ]</span>)</span>;</code></dt><dd><p><code>csp(directives)</code> is a filter that applies the <code>Content-Security-Policy</code> header <code>directives</code> to the response.</p></dd></dl><dl><dt class="spec value" id="val-hsts"><a href="#val-hsts" class="anchor"></a><code><span class="keyword">let</span> hsts: <a href="../../../ReWeb__Header/StrictTransportSecurity/index.html#type-t">ReWeb__Header.StrictTransportSecurity.t</a> <span>=&gt;</span> <a href="index.html#type-t">t</a><span>(<span class="type-var">'ctx</span>, <span class="type-var">'ctx</span>, <span>[ <a href="../../Response/index.html#type-http">Response.http</a> <span>| <a href="../../Response/index.html#type-websocket">Response.websocket</a></span> ]</span>)</span>;</code></dt><dd><p><code>hsts(value)</code> is a filter that applies the HTTP Strict Transport Security header to the response.</p></dd></dl><dl><dt class="spec value" id="val-multipart_form"><a href="#val-multipart_form" class="anchor"></a><code><span class="keyword">let</span> multipart_form: <span>typ:<a href="../../Form/index.html#type-t">Form.t</a><span>(<span class="type-var">'ctor</span>, <span class="type-var">'ty</span>)</span></span> <span>=&gt;</span> <span>(<span>filename:string</span> <span>=&gt;</span> string <span>=&gt;</span> string)</span> <span>=&gt;</span> <a href="index.html#type-t">t</a><span>(unit, <span class="type-var">'ty</span>, <span>[&gt; <a href="../../Response/index.html#type-http">Response.http</a> ]</span>)</span>;</code></dt><dd><p><code>multipart_form(~typ, path)</code> is a filter that decodes multipart form data. <code>typ</code> must be provided but if you don't actually have any other fields in the form you can use <code>Form.empty</code> to decode into an 'empty' (unit) value.</p><p><code>path(~filename, name)</code> is used to get the filesystem absolute path to save the given <code>filename</code> with corresponding form field <code>name</code>. Note that:</p><ul><li>The file will be overwritten if it already exists on disk</li><li><code>filename</code> is the basename, not the full path</li><li>The filter will short-circuit with a 401 Unauthorized error response if any of the files can't be opened for writing.</li></ul><p>This callback gives you a chance to sanitize incoming filenames before storing the files on disk.</p></dd></dl><dl><dt class="spec value" id="val-query_form"><a href="#val-query_form" class="anchor"></a><code><span class="keyword">let</span> query_form: <a href="../../Form/index.html#type-t">Form.t</a><span>(<span class="type-var">'ctor</span>, <span class="type-var">'ty</span>)</span> <span>=&gt;</span> <a href="index.html#type-t">t</a><span>(<span class="type-var">'ctx</span>, {. query: <span class="type-var">'ty</span>, prev: <span class="type-var">'ctx</span>, }, <a href="../../Response/index.html#type-t">Response.t</a>(<span class="type-var">_</span>))</span>;</code></dt><dd><p><code>query_form(typ)</code> is a filter that decodes the request query (the part after the <code>?</code> in the endpoint) into a value of type <code>'ty</code> and stores it in the request context for the next service. The decoding and failure works in the same way as for <code>body_form</code>.</p></dd></dl></div></body></html>