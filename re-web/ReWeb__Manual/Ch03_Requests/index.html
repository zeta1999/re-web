<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Ch03_Requests (re-web.ReWeb__Manual.Ch03_Requests)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">re-web</a> &#x00BB; <a href="../index.html">ReWeb__Manual</a> &#x00BB; Ch03_Requests</nav><h1>Module <code>ReWeb__Manual.Ch03_Requests</code></h1><p>Details on requests--how to use them.</p><nav class="toc"><ul><li><a href="#operations">Operations</a></li><li><a href="#request-bodies">Request bodies</a></li></ul></nav></header><aside></aside><aside><p>A ReWeb request data structure is a thin wrapper over an <a href="https://b0-system.github.io/odig/doc@odoc.default/httpaf/Httpaf/Reqd/index.html">Httpaf request descriptor</a>. It additionally contains the request query string, and a generic 'context' value. This makes the request itself generic--in other words, the request type exposes the type of context it contains. This enables filters and services in the request pipeline to safely compose and ensure they only use contexts of the correct type.</p></aside><section><header><h2 id="operations"><a href="#operations" class="anchor"></a>Operations</h2><p>Requests expose simple operations, like <a href="../../ReWeb__Server/Request/index.html#val-context"><code>ReWeb.Request.context</code></a>, <a href="../../ReWeb__Server/Request/index.html#val-header"><code>ReWeb.Request.header</code></a>, <a href="../../ReWeb__Server/Request/index.html#val-cookies"><code>ReWeb.Request.cookies</code></a>. These accessors are cheap because they don't touch the request body.</p><p>Requests also allow you to read their bodies with <a href="../../ReWeb__Server/Request/index.html#val-body"><code>ReWeb.Request.body</code></a> and <a href="../../ReWeb__Server/Request/index.html#val-body_string"><code>ReWeb.Request.body_string</code></a>. These operations are more expensive and should only be done once per request. ReWeb tries to ensure this by requiring that the request's body has not already been read, by requiring the input request type to be <code>unit Request.t</code>.</p><p>The reasoning behind this is that top-level requests should be ones directly from the client, and not touched by any filters which could read the body (because those filters would output requests with a different context type, not <code>unit</code>). This should hold true as long as you ensure that all filters which read request bodies appropriately set the context type--i.e. by putting either the body directly, or some data derived from the body, in the context.</p><p>The filters that ReWeb ships with, all respect this rule. However, it is possible to write filters which don't. So there is a possibility of double-reading the body and getting a runtime error. Using and building upon the filters in <a href="../../ReWeb/Filter/index.html"><code>ReWeb.Filter</code></a> should minimize this.</p></header></section><section><header><h2 id="request-bodies"><a href="#request-bodies" class="anchor"></a>Request bodies</h2><p>Request bodies are modelled by the type <code>Piaf.Body.t</code> in Antonio Monteiro's excellent web library, <a href="https://github.com/anmonteiro/piaf/">Piaf</a>. See its <a href="https://github.com/anmonteiro/piaf/blob/830d238360f255ae465436744861c36c7c6b2504/lib/piaf.mli#L152">interface declaration</a> to get an idea of what you can do what request bodies.</p><p>You will mostly not need to care about dealing with request bodies directly if you use one of the provided filters which read and store the body.</p><p>One possible exception is if you want to directly echo the request body without touching it--in that case you can get the body using <a href="../../ReWeb__Server/Request/index.html#val-body"><code>ReWeb.Request.body</code></a> and passing it to <a href="../../ReWeb__/Response/index.html#val-of_http"><code>ReWeb.Response.of_http</code></a>. Remember that request and response bodies are the same type. We will cover ReWeb responses in the next chapter.</p></header></section></div></body></html>